@prefix : <http://f4w.restdesc.org/demo#>.
@prefix http: <http://www.w3.org/2011/http#>.
@prefix tmpl: <http://multimedialab.elis.ugent.be/organon/ontologies/tmpl#>.
@prefix math: <http://www.w3.org/2000/10/swap/math#>.
@prefix e: <http://eulersharp.sourceforge.net/2003/03swap/log-rules#>.


# API “worker” measure
{
    ?x a :calibration;
       :part_number ?n;
       :machine_parameters (?p1 ?p2 ?p3 ?p4).
}
=>
{
    _:request http:methodName "GET";
              tmpl:requestURI ("http://askTheWorker/" "doMeasurement");
              #:root ?x;
              http:body [
                  :message "Please measure a new part with the following settings.";
                  :part_number ?n;
                  :machine_parameters (?p1 ?p2 ?p3 ?p4)
              ];
              http:resp [
                  http:body[
                      :geometrical_dimension (_:d1 _:d2)
                  ]
              ].
    ?x :geometrical_dimension (_:d1 _:d2).
?x a :calibration.
}.


# API2
{
    ?x a :calibration.
    ?x :operator ?o;
       :part_number ?n;
       :machine_parameters (?p1 ?p2 ?p3 ?p4);
       :tolerances ((?min1 ?max1) (?min2 ?max2)); # problem with nested objects
       :geometrical_dimension (?t1 ?t2).
 
#We replaced that by chaniging the order of the goal. Both solutions aren't good. We have to find a better one!      
 #   (?S ?SP) e:findall ( ?L { ?x :result ?L } ()). # prevents this API from being called twice with the same calibration
}
=>
{
    _:request http:methodName "POST";
              tmpl:requestURI ("http://pacific-shore-4503.herokuapp.com/calibrations");
              #:root ?x;
              http:body [
                  :operator ?o;
                  :part_number ?n;
                  :machine_parameters (?p1 ?p2 ?p3 ?p4);
                  :tolerances ((?min1 ?max1) (?min2 ?max2));
                  :geometrical_dimension (?t1 ?t2)
              ];
              http:resp [
                  http:body[
                      :id _:id;
                      :result ?ok;
                      :suggested_parameters (_:pp1 _:pp2 _:pp3 _:pp4)
                  ]         
              ].
    ?x :result ?ok;  
       :suggested_parameters (_:pp1 _:pp2 _:pp3 _:pp4).
}.



